<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Viaje de Andy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, #d6eaff, #ffffff);
            height: 100vh;
            overflow-y: auto;
            display: grid;
            place-items: center;
            margin: 0;
        }

        /* Base (Portrait/Mobile) Layout */
        .parent {
            width: 100%;
            height: 100%;
            padding: 0.5rem;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 0px;
        }

        .div1 {
            grid-area: 1 / 1 / 2 / 11;
            height: auto;
        }

        .div2 {
            grid-area: 2 / 1 / 3 / 11;
            text-align: center;
        }

        .div3 {
            display: flex;
            align-content: center;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            grid-area: 8 / 1 / 9 / 11;
        }

        .div4 {
            grid-area: 3 / 1 / 8 / 11;
        }

        .div5 {
            grid-area: 9 / 1 / 11 / 11;
        }

        /* Landscape/Desktop Layout */
        @media (min-width: 768px) {
            .parent {
                padding: 2rem;
                width: 91.666667%;
                max-width: 80rem;
                height: 95vh;
                grid-template-columns: repeat(10, 1fr);
                grid-template-rows: repeat(5, 1fr);
            }

            .div1 {
                grid-area: 1 / 1 / 2 / 11;
            }

            .div2 {
                grid-area: 2 / 1 / 5 / 3;
            }

            .div3 {
                display: flex;
                flex-direction: column;
                grid-area: 5 / 1 / 6 / 3;
            }

            .div4 {
                grid-area: 2 / 3 / 5 / 11;
            }

            .div5 {
                grid-area: 5 / 3 / 6 / 11;
            }
        }

        /* General Styling */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: auto;
            height: 5vh;
            padding: 0.5rem 1rem;
            background-color: #2563eb;
            border-radius: 0.75rem;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .top-bar h1 {
            font-size: clamp(1rem, 2vw, 1.5rem);
            font-weight: 700;
        }

        .top-bar h2 {
            font-size: clamp(0.875rem, 1.5vw, 1.25rem);
            font-weight: 600;
        }

        .menu-icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-icon-btn img {
            width: clamp(1.5rem, 3vw, 2rem);
            height: auto;
        }

        .command-sidebar {
            display: grid;
            grid-template-rows: auto 1fr;
            background-color: #dbeafe;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
            border: 1px solid #bfdbfe;
        }

        .game-area {
            position: relative;
            border-radius: 0.75rem;
            border: 4px solid #d1d5db;
            overflow: hidden;
            display: grid;
            place-items: center;
            background-color: #e0f2fe;
        }

        .program-area-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            height: 80%;
            gap: 0.5rem;
            padding: 0.75rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px 0 rgb(0 0 0 / 0.05);
            border: 2px dashed #9ca3af;
            min-height: 60px;
            overflow-x: auto;
            white-space: nowrap;
        }

        .command-list {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
        }

        @media (min-width: 768px) {
            .command-list {
                display: grid;
                grid-template-columns: 1fr;
            }
        }

        .command-icon-container {
            padding: 0.5rem;
            border-radius: 0.75rem;
            margin: auto;
            background-color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 1px solid #d1d5db;
            height: 75%;
            width: 75%;
            display: grid;
            place-items: center;
            cursor: pointer;
            transform: scale(1);
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
            touch-action: manipulation;
        }

        .command-icon-container:active {
            transform: scale(0.95);
            box-shadow: none;
        }

        .command-icon-img {
            width: auto;
            height: 100%;
        }

        .program-item {
            flex-shrink: 0;
            width: 60px;
            height: 60px;
            padding: 0.5rem;
            background-color: #a7f3d0;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            display: grid;
            place-items: center;
        }

        .program-item:hover {
            transform: scale(1.05);
        }

        .program-item img {
            width: 100%;
            height: 100%;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            width: 90%;
            margin: auto;
            border: none;
            cursor: pointer;
            text-align: center;
            font-weight: 700;
            font-size: 1.125rem;
            line-height: 1.75rem;
            transition: all 0.2s ease-in-out;
            transform: scale(1);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-go {
            background-color: #84cc16;
            color: white;
        }

        .btn-go:hover {
            background-color: #65a30d;
        }

        .btn-reset {
            background-color: #f87171;
            color: white;
        }

        .btn-reset:hover {
            background-color: #ef4444;
        }

        .btn-level {
            width: 100%;
            padding: 0.75rem 1.5rem;
            background-color: #3b82f6;
            color: white;
            margin-bottom: 1rem;
        }

        .btn-level:hover {
            background-color: #2563eb;
        }

        #message-box,
        #difficulty-menu,
        #level-selection-menu {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: grid;
            place-items: center;
            z-index: 50;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s linear;
        }
        .hidden {
            display: none !important;
        }

        #message-box.visible,
        #difficulty-menu.visible,
        #level-selection-menu.visible {
            visibility: visible;
            opacity: 1;
        }

        #message-content,
        #difficulty-menu-content,
        #level-selection-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            transform: scale(1);
            transition: transform 0.3s ease-in-out;
        }

        #message-content.scale-0,
        #difficulty-menu-content.scale-0,
        #level-selection-content.scale-0 {
            transform: scale(0);
        }

        #game-canvas {
            background-color: #e0f2fe;
            touch-action: none;
        }
    </style>
</head>

<body>
    <div class="parent">
        <!-- Top bar (div1) -->
        <header class="div1 top-bar">
            <h1 style="font-size: clamp(1rem, 2vw, 1.5rem); font-weight: bold;">El Viaje de Andy</h1>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <h2 id="level-title" style="font-size: clamp(0.875rem, 1.5vw, 1.25rem); font-weight: 600;"></h2>
                <button onclick="showDifficultyMenu()" class="menu-icon-btn">
                    <img src="https://api.iconify.design/pixelarticons:menu.svg?color=%23ffffff" alt="Men√∫">
                </button>
            </div>
        </header>

        <!-- Command sidebar (div2 - Desktop), Actions (div2 - Mobile) -->
        <div class="div2 command-sidebar">
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #1e40af;">Acciones</h3>
            <div id="command-list" class="command-list">
                <div class="command-icon-container" data-command="moveForward">
                    <img class="command-icon-img"
                        src="https://api.iconify.design/pixelarticons:arrow-up.svg?color=%231e40af" alt="Adelante">
                </div>
                <div class="command-icon-container" data-command="moveBackward">
                    <img class="command-icon-img"
                        src="https://api.iconify.design/pixelarticons:arrow-down.svg?color=%231e40af" alt="Atr√°s">
                </div>
                <div class="command-icon-container" data-command="turnLeft">
                    <img class="command-icon-img"
                        src="https://api.iconify.design/pixelarticons:arrow-left.svg?color=%231e40af"
                        alt="Girar Izquierda">
                </div>
                <div class="command-icon-container" data-command="turnRight">
                    <img class="command-icon-img"
                        src="https://api.iconify.design/pixelarticons:arrow-right.svg?color=%231e40af"
                        alt="Girar Derecha">
                </div>
                <div class="command-icon-container" data-command="pause">
                    <img class="command-icon-img"
                        src="https://api.iconify.design/pixelarticons:pause.svg?color=%231e40af" alt="Pausa">
                </div>
            </div>
        </div>
        <script>
            // Add this after the command list HTML to wire up click events
            document.addEventListener('DOMContentLoaded', function () {
                const commandList = document.getElementById('command-list');
                if (commandList) {
                    commandList.addEventListener('click', appendCommandToProgramFromEvent);
                }
            });
        </script>

        <!-- Go/Clean Buttons (div3) -->
        <div class="div3">
            <button class="btn btn-go" onclick="executeProgram()">GO</button>
            <button class="btn btn-reset" onclick="resetProgram()">Limpiar</button>
        </div>

        <!-- Game Area (div4) -->
        <div id="canvas-container" class="div4 game-area">
            <canvas id="game-canvas"></canvas>
        </div>

        <!-- Programmed actions bar (div5) -->
        <footer class="div5">
            <div id="program-area" class="program-area-container"></div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="difficulty-menu">
        <div id="difficulty-menu-content">
            <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; color: #1e40af;">Seleccionar
                Dificultad
            </h3>
            <div style="display: grid; grid-template-columns: 1fr; gap: 1rem; width: 100%;">
                <button class="btn-level" onclick="showLevelSelection(4, 'F√°cil (4x4)')">F√°cil (4x4)</button>
                <button class="btn-level" onclick="showLevelSelection(6, 'Medio (6x6)')">Medio (6x6)</button>
                <button class="btn-level" onclick="showLevelSelection(8, 'Dif√≠cil (8x8)')">Dif√≠cil (8x8)</button>
                <button class="btn-level" style="background-color: #6b7280;"
                    onclick="hideDifficultyMenu()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="level-selection-menu">
        <div id="level-selection-content">
            <h3 id="level-selection-title"
                style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; color: #1e40af;">Seleccionar Nivel
            </h3>
            <div id="level-buttons-container"
                style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; width: 100%;">
            </div>
            <button class="btn-level" style="background-color: #6b7280; margin-top: 1rem;"
                onclick="showDifficultyMenu()">Regresar</button>
        </div>
    </div>

    <div id="message-box">
        <div id="message-content">
            <h3 id="message-text" style="font-size: 1.875rem; font-weight: bold; margin-bottom: 1rem;"></h3>
            <button class="btn" style="background-color: #3b82f6; color: white; " onclick="hideMessage()">OK</button>
        </div>
    </div>

    <script>
        // Global game state variables.
        let canvas, ctx;
        let gridSize = 4;
        let level = 0;
        let gameData = {};
        let program = [];
        let isAnimating = false;
        let programArea;
        let assetsLoaded = false;

        let TILE_SIZE = 60;
        let ROBOT_SIZE = 40;
        let PADDING = 20;

        let startImage = new Image();
        let endImage = new Image();
        let robotImage = new Image();

        // All functions are declared at the top level of the script block.
        function startGame(size, newLevel) {
            gridSize = size;
            level = newLevel;
            hideDifficultyMenu();
            hideLevelSelectionMenu();
            loadLevel();
        }

        function hideDifficultyMenu() {
            document.getElementById('difficulty-menu').classList.remove('visible');
        }

        function hideLevelSelectionMenu() {
            document.getElementById('level-selection-menu').classList.remove('visible');
        }

        function showDifficultyMenu() {
            document.getElementById('difficulty-menu').classList.add('visible');
            document.getElementById('level-selection-menu').classList.remove('visible');
        }

        function showLevelSelection(size, title) {
            hideDifficultyMenu();
            const container = document.getElementById('level-buttons-container');
            container.innerHTML = '';
            document.getElementById('level-selection-title').textContent = title;
            let levelsArray = [];
            if (size === 4) {
                levelsArray = easyMazes;
            } else if (size === 6) {
                levelsArray = mediumMazes;
            } else if (size === 8) {
                levelsArray = hardMazes;
            }

            levelsArray.forEach((maze, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn-level';
                btn.textContent = `Nivel ${index + 1}`;
                btn.onclick = () => startGame(size, index);
                container.appendChild(btn);
            });

            document.getElementById('level-selection-menu').classList.add('visible');
        }

        function showMessage(text, isSuccess = false) {
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            messageText.textContent = text;
            messageBox.classList.add('visible');
            document.getElementById('message-content').classList.remove('scale-0');

            const btn = document.querySelector("#message-content button");
            if (isSuccess) {
                btn.onclick = () => {
                    hideMessage();
                    if (gridSize === 4 && level < easyMazes.length) {
                        level++;
                    } else if (gridSize === 6 && level < mediumMazes.length) {
                        level++;
                    } else if (gridSize === 8 && level < hardMazes.length) {
                        level++;
                    }
                    loadLevel();
                };
            } else {
                btn.onclick = () => {
                    hideMessage();
                    resetProgram();
                };
            }
        }

        function hideMessage() {
            const messageBox = document.getElementById('message-box');
            document.getElementById('message-content').classList.add('scale-0');
            setTimeout(() => {
                messageBox.classList.remove('visible');
            }, 300);
        }

        function parseMazeData(charMaze) {
            const rows = charMaze.length;
            const cols = charMaze[0].length;
            const maze = Array.from({
                length: rows
            }, () => Array.from({
                length: cols
            }, () => ({
                isWall: false
            })));
            let startPos = null;
            let endPos = null;

            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const char = charMaze[y][x];
                    if (char === 'S') startPos = { x, y, dir: 0 };
                    if (char === 'D') endPos = { x, y };
                    if (char === 'W') {
                        maze[y][x].isWall = true;
                    }
                    // Treat any other character except 'W' as open path
                    // (including 'R', 'S', 'D')
                }
            }
            if (!startPos) {
                console.error("Start position 'S' not found in the maze.");
                startPos = { x: 0, y: 0, dir: 0 };
                if (maze[startPos.y][startPos.x].isWall) {
                    maze[startPos.y][startPos.x].isWall = false;
                }
            }
            if (!endPos) {
                console.error("End position 'D' not found in the maze.");
                endPos = { x: cols - 1, y: rows - 1 };
                if (maze[endPos.y][endPos.x].isWall) {
                    maze[endPos.y][endPos.x].isWall = false;
                }
            }
            return {
                maze,
                start: startPos,
                end: endPos
            };
        }

        function drawGame() {
            if (!assetsLoaded || !gameData.maze || !canvas || !ctx) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    const rectX = x * TILE_SIZE + PADDING;
                    const rectY = y * TILE_SIZE + PADDING;

                    if (gameData.maze[y][x].isWall) {
                        ctx.fillStyle = '#1e40af';
                        ctx.fillRect(rectX, rectY, TILE_SIZE, TILE_SIZE);
                    } else {
                        ctx.fillStyle = '#e0f2fe';
                        ctx.fillRect(rectX, rectY, TILE_SIZE, TILE_SIZE);
                    }

                    ctx.strokeStyle = '#6b7280';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(rectX, rectY, TILE_SIZE, TILE_SIZE);
                }
            }

            const startX = gameData.start.x * TILE_SIZE + PADDING;
            const startY = gameData.start.y * TILE_SIZE + PADDING;
            if (startImage.complete) {
                ctx.drawImage(startImage, startX, startY, TILE_SIZE, TILE_SIZE);
            }

            const endX = gameData.end.x * TILE_SIZE + PADDING;
            const endY = gameData.end.y * TILE_SIZE + PADDING;
            if (endImage.complete) {
                ctx.drawImage(endImage, endX, endY, TILE_SIZE, TILE_SIZE);
            }

            drawRobot(gameData.robot.x, gameData.robot.y, gameData.robot.dir);
        }

        function drawRobot(x, y, dir) {
            if (!ctx || !robotImage) return;
            const centerX = x * TILE_SIZE + PADDING + TILE_SIZE / 2;
            const centerY = y * TILE_SIZE + PADDING + TILE_SIZE / 2;
            const rotation = dir * Math.PI / 2;

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(rotation);

            const robotWidth = ROBOT_SIZE;
            const robotHeight = ROBOT_SIZE;
            const robotX = -robotWidth / 2;
            const robotY = -robotHeight / 2;

            if (robotImage.complete) {
                ctx.drawImage(robotImage, robotX, robotY, robotWidth, robotHeight);
            }

            ctx.restore();
        }

        function appendCommandToProgramFromEvent(e) {
            const target = e.target.closest('.command-icon-container');
            if (target) {
                const command = target.dataset.command;
                program.push(command);
                syncProgramAreas();
            }
        }

        function syncProgramAreas() {
            if (!programArea) return;
            programArea.innerHTML = '';

            program.forEach((command, index) => {
                const img = document.querySelector(`.command-icon-container[data-command="${command}"] img`).cloneNode(true);
                const newProgramItem = document.createElement('div');
                newProgramItem.className = 'program-item';
                newProgramItem.dataset.command = command;
                newProgramItem.dataset.index = index;
                newProgramItem.appendChild(img);

                newProgramItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (isAnimating) return;
                    program.splice(parseInt(e.currentTarget.dataset.index), 1);
                    syncProgramAreas();
                });

                programArea.appendChild(newProgramItem);
            });
            document.querySelectorAll('.program-item').forEach((item, index) => {
                item.dataset.index = index;
            });
        }

        async function executeProgram() {
            if (isAnimating || program.length === 0) return;
            isAnimating = true;
            disableButtons();

            gameData.robot = {
                x: gameData.start.x,
                y: gameData.start.y,
                dir: gameData.start.dir
            };
            drawGame();
            await new Promise(resolve => setTimeout(resolve, 500));

            for (let i = 0; i < program.length; i++) {
                const command = program[i];
                if (command === 'pause') {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    continue;
                }

                const { x, y, dir } = gameData.robot;
                let newX = x;
                let newY = y;
                let newDir = dir;

                switch (command) {
                    case 'moveForward':
                        if (dir === 0) newY--;
                        else if (dir === 1) newX++;
                        else if (dir === 2) newY++;
                        else if (dir === 3) newX--;
                        break;
                    case 'moveBackward':
                        if (dir === 0) newY++;
                        else if (dir === 1) newX--;
                        else if (dir === 2) newY--;
                        else if (dir === 3) newX++;
                        break;
                    case 'turnLeft':
                        newDir = (dir - 1 + 4) % 4;
                        break;
                    case 'turnRight':
                        newDir = (dir + 1) % 4;
                        break;
                }

                if (newX < 0 || newX >= gridSize || newY < 0 || newY >= gridSize || gameData.maze[newY][newX].isWall) {
                    showMessage("¬°Uy! Andy choc√≥ con una pared.");
                    isAnimating = false;
                    enableButtons();
                    return;
                }

                gameData.robot.x = newX;
                gameData.robot.y = newY;
                gameData.robot.dir = newDir;
                drawGame();
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            if (gameData.robot.x === gameData.end.x && gameData.robot.y === gameData.end.y) {
                showMessage("¬°Misi√≥n cumplida! Andy lleg√≥ al final. üéâ", true);
            } else {
                showMessage("¬°No llegaste! Int√©ntalo de nuevo. üòû");
            }

            isAnimating = false;
            enableButtons();
        }

        function resetProgram() {
            if (isAnimating) return;
            program = [];
            syncProgramAreas();
            if (gameData.start) {
                gameData.robot = {
                    x: gameData.start.x,
                    y: gameData.start.y,
                    dir: gameData.start.dir
                };
            }
            drawGame();
        }

        function disableButtons() {
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            document.querySelectorAll('.command-icon-container').forEach(icon => icon.style.pointerEvents = 'none');
        }

        function enableButtons() {
            document.querySelectorAll('button').forEach(btn => btn.disabled = false);
            document.querySelectorAll('.command-icon-container').forEach(icon => icon.style.pointerEvents = 'auto');
        }

        function loadLevel() {
            let currentMazeChar;
            let currentTitle;
            let totalLevels;

            if (gridSize === 4) {
                totalLevels = easyMazes.length;
                if (level < totalLevels) {
                    currentMazeChar = easyMazes[level];
                    currentTitle = `Laberinto ${level + 1} de ${totalLevels}: ¬°Aprende los conceptos!`;
                } else {
                    showMessage("¬°Felicidades! Has completado todos los niveles de 4x4. ¬°Selecciona una nueva dificultad!", false);
                    return;
                }
            } else if (gridSize === 6) {
                totalLevels = mediumMazes.length;
                if (level < totalLevels) {
                    currentMazeChar = mediumMazes[level];
                    currentTitle = `Laberinto ${level + 1} de ${totalLevels}: ¬°Nivel Medio!`;
                } else {
                    showMessage("¬°Felicidades! Has completado todos los niveles de 6x6. ¬°Selecciona una nueva dificultad!", false);
                    return;
                }
            } else if (gridSize === 8) {
                totalLevels = hardMazes.length;
                if (level < totalLevels) {
                    currentMazeChar = hardMazes[level];
                    currentTitle = `Laberinto ${level + 1} de ${totalLevels}: ¬°Nivel Dif√≠cil!`;
                } else {
                    showMessage("¬°Felicidades! Has completado todos los niveles de 8x8. ¬°Selecciona una nueva dificultad!", false);
                    return;
                }
            } else {
                console.error("Invalid gridSize provided.");
                return;
            }

            const parsedData = parseMazeData(currentMazeChar);
            gameData.maze = parsedData.maze;
            gameData.start = parsedData.start;
            gameData.end = parsedData.end;
            gameData.title = currentTitle;

            document.getElementById('level-title').textContent = gameData.title;
            gameData.robot = {
                x: gameData.start.x,
                y: gameData.start.y,
                dir: gameData.start.dir
            };
            resetProgram();
            resizeCanvas();
        }

        function initGame() {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            programArea = document.getElementById('program-area');

            loadAssets();
            window.addEventListener('resize', resizeCanvas);
        }

        function loadAssets() {
            let imagesToLoad = 3;
            const onImageLoad = () => {
                imagesToLoad--;
                if (imagesToLoad === 0) {
                    assetsLoaded = true;
                    startGame(4, 0);
                }
            };
            startImage.onload = onImageLoad;
            endImage.onload = onImageLoad;
            robotImage.onload = onImageLoad;

            startImage.src = 'assets/img/house.png';
            endImage.src = 'assets/img/croppedNEA.png';
            robotImage.src = 'assets/img/andy.png';
        }

        function resizeCanvas() {
            const canvasContainer = document.getElementById('canvas-container');
            if (!canvasContainer || !canvas) {
                console.error("Canvas container or canvas element not found.");
                return;
            }
            const containerWidth = canvasContainer.offsetWidth;
            const containerHeight = canvasContainer.offsetHeight;
            const minSize = Math.min(containerWidth, containerHeight);

            const paddingFactor = 0.9;
            const availableSize = minSize * paddingFactor;
            const minTileSize = 40;
            TILE_SIZE = Math.max(minTileSize, Math.floor(availableSize / gridSize));
            ROBOT_SIZE = Math.floor(TILE_SIZE * 0.7);
            let newPadding = (minSize - (TILE_SIZE * gridSize)) / 2;
            PADDING = newPadding > 0 ? newPadding : 0;

            canvas.width = gridSize * TILE_SIZE + PADDING * 2;
            canvas.height = gridSize * TILE_SIZE + PADDING * 2;
            drawGame();
        }

        // The following code defines the maze data.
        const easyMazes = [
            // Maze 1: Straight line
            [
                ['R', 'R', 'R', 'D'],
                ['R', 'W', 'W', 'W'],
                ['S', 'W', 'W', 'W'],
                ['W', 'W', 'W', 'W']
            ],
            // Maze 2: L-shape
            [
                ['R', 'W', 'D', 'W'],
                ['R', 'R', 'R', 'W'],
                ['W', 'W', 'R', 'W'],
                ['S', 'R', 'R', 'W']
            ],
            // Maze 3: Zigzag
            [
                ['S', 'R', 'W', 'W'],
                ['W', 'R', 'W', 'W'],
                ['W', 'R', 'R', 'R'],
                ['W', 'W', 'W', 'D']
            ],
            // Maze 4: U-shape
            [
                ['S', 'W', 'W', 'D'],
                ['R', 'W', 'W', 'R'],
                ['R', 'W', 'W', 'R'],
                ['R', 'R', 'R', 'R']
            ],
            // Maze 5: With backtrack
            [
                ['S', 'R', 'W', 'W'],
                ['R', 'R', 'R', 'R'],
                ['W', 'W', 'W', 'R'],
                ['D', 'R', 'R', 'R']
            ],
            // New Easy Mazes (6-10)
            [
                ['S', 'W', 'R', 'R'],
                ['R', 'R', 'R', 'W'],
                ['R', 'W', 'W', 'W'],
                ['D', 'R', 'R', 'R']
            ],
            [
                ['S', 'R', 'R', 'W'],
                ['W', 'W', 'R', 'W'],
                ['W', 'R', 'R', 'D'],
                ['W', 'R', 'W', 'W']
            ],
            [
                ['S', 'R', 'W', 'D'],
                ['W', 'R', 'W', 'R'],
                ['R', 'R', 'R', 'R'],
                ['R', 'W', 'W', 'R']
            ],
            [
                ['S', 'W', 'W', 'W'],
                ['R', 'R', 'R', 'D'],
                ['R', 'W', 'W', 'R'],
                ['R', 'R', 'W', 'R']
            ],
            [
                ['S', 'R', 'R', 'W'],
                ['W', 'R', 'W', 'R'],
                ['W', 'R', 'R', 'R'],
                ['W', 'W', 'W', 'D']
            ]
        ];

        const mediumMazes = [
            // 6x6 Maze 1
            [
                ['S', 'R', 'R', 'R', 'W', 'W'],
                ['W', 'W', 'W', 'R', 'W', 'W'],
                ['W', 'R', 'R', 'R', 'W', 'W'],
                ['W', 'R', 'W', 'W', 'W', 'W'],
                ['W', 'R', 'R', 'R', 'R', 'W'],
                ['W', 'W', 'W', 'W', 'R', 'D']
            ],
            // 6x6 Maze 2
            [
                ['W', 'W', 'W', 'R', 'R', 'D'],
                ['W', 'S', 'R', 'R', 'W', 'W'],
                ['W', 'W', 'W', 'R', 'W', 'W'],
                ['W', 'W', 'W', 'R', 'W', 'W'],
                ['R', 'R', 'R', 'R', 'W', 'W'],
                ['R', 'W', 'W', 'W', 'W', 'W']
            ],
            // 6x6 Maze 3
            [
                ['S', 'R', 'R', 'R', 'W', 'W'],
                ['W', 'W', 'R', 'W', 'W', 'W'],
                ['W', 'R', 'R', 'W', 'W', 'W'],
                ['W', 'R', 'W', 'W', 'R', 'R'],
                ['W', 'R', 'W', 'W', 'R', 'W'],
                ['W', 'R', 'R', 'R', 'R', 'D']
            ],
            // 6x6 Maze 4
            [
                ['W', 'R', 'R', 'R', 'W', 'D'],
                ['W', 'R', 'W', 'W', 'W', 'R'],
                ['S', 'R', 'R', 'W', 'R', 'R'],
                ['W', 'R', 'W', 'W', 'R', 'W'],
                ['W', 'R', 'W', 'R', 'R', 'W'],
                ['W', 'R', 'R', 'R', 'W', 'W']
            ],
            // 6x6 Maze 5
            [
                ['S', 'R', 'R', 'W', 'W', 'W'],
                ['W', 'W', 'R', 'W', 'W', 'W'],
                ['W', 'R', 'R', 'R', 'R', 'W'],
                ['W', 'R', 'W', 'W', 'R', 'W'],
                ['W', 'R', 'R', 'R', 'R', 'W'],
                ['W', 'W', 'W', 'W', 'R', 'D']
            ]
        ];

        const hardMazes = [
            // 8x8 Maze 1
            [
                ['S', 'R', 'R', 'R', 'W', 'W', 'W', 'W'],
                ['W', 'W', 'R', 'W', 'R', 'R', 'R', 'R'],
                ['W', 'R', 'R', 'R', 'R', 'W', 'W', 'W'],
                ['W', 'R', 'W', 'W', 'W', 'W', 'W', 'W'],
                ['W', 'R', 'R', 'W', 'R', 'R', 'R', 'W'],
                ['W', 'W', 'R', 'R', 'R', 'W', 'R', 'W'],
                ['W', 'W', 'W', 'W', 'R', 'W', 'R', 'D'],
                ['W', 'R', 'R', 'R', 'R', 'W', 'R', 'W']
            ],
            // 8x8 Maze 2
            [
                ['S', 'W', 'R', 'R', 'W', 'W', 'R', 'D'],
                ['R', 'W', 'R', 'W', 'W', 'R', 'R', 'W'],
                ['R', 'R', 'R', 'R', 'R', 'R', 'W', 'W'],
                ['W', 'W', 'R', 'W', 'W', 'W', 'W', 'W'],
                ['W', 'R', 'R', 'R', 'W', 'W', 'W', 'W'],
                ['W', 'R', 'W', 'R', 'R', 'R', 'W', 'W'],
                ['W', 'R', 'W', 'R', 'W', 'R', 'R', 'R'],
                ['W', 'R', 'W', 'R', 'R', 'R', 'W', 'R']
            ],
            // 8x8 Maze 3
            [
                ['S', 'R', 'W', 'W', 'W', 'W', 'W', 'W'],
                ['R', 'R', 'R', 'W', 'W', 'W', 'W', 'W'],
                ['W', 'W', 'R', 'R', 'R', 'W', 'W', 'W'],
                ['W', 'W', 'W', 'W', 'R', 'R', 'R', 'W'],
                ['W', 'W', 'R', 'W', 'W', 'W', 'R', 'W'],
                ['W', 'R', 'R', 'W', 'W', 'R', 'R', 'W'],
                ['W', 'R', 'W', 'W', 'R', 'R', 'W', 'W'],
                ['W', 'R', 'R', 'R', 'R', 'W', 'W', 'D']
            ],
            // 8x8 Maze 4
            [
                ['S', 'R', 'W', 'W', 'R', 'R', 'W', 'W'],
                ['R', 'R', 'W', 'R', 'R', 'W', 'R', 'W'],
                ['W', 'R', 'W', 'R', 'W', 'W', 'R', 'R'],
                ['W', 'R', 'R', 'R', 'R', 'W', 'W', 'R'],
                ['W', 'W', 'W', 'W', 'R', 'R', 'R', 'R'],
                ['W', 'R', 'R', 'W', 'W', 'W', 'R', 'W'],
                ['R', 'R', 'W', 'W', 'R', 'R', 'R', 'R'],
                ['D', 'W', 'W', 'R', 'R', 'W', 'R', 'W']
            ],
            // 8x8 Maze 5
            [
                ['S', 'R', 'W', 'R', 'W', 'R', 'R', 'W'],
                ['R', 'R', 'W', 'R', 'W', 'W', 'R', 'R'],
                ['W', 'R', 'W', 'R', 'W', 'W', 'W', 'R'],
                ['R', 'R', 'R', 'R', 'R', 'W', 'W', 'R'],
                ['R', 'W', 'W', 'W', 'R', 'R', 'R', 'R'],
                ['R', 'W', 'W', 'W', 'W', 'W', 'W', 'R'],
                ['R', 'R', 'R', 'R', 'R', 'R', 'R', 'R'],
                ['D', 'W', 'W', 'W', 'W', 'W', 'W', 'W']
            ]
        ];

        // This event listener replaces the body onload attribute for safer initialization.
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>

</html>
